<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VibeNet Login</title>
<script async src="https://www.googletagmanager.com/gtag/js?id=YOUR_GA_TRACKING_ID"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'YOUR_GA_TRACKING_ID');
</script>
<style>
  :root{
    --red:#c7121a;
    --white:#ffffff;
    --bg:#fff6f6;
  }
  body{
    margin:0;
    font-family:Arial,sans-serif;
    background:var(--bg);
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
  }
  .container{
    background:var(--white);
    padding:30px;
    border-radius:15px;
    box-shadow:0 10px 25px rgba(200,0,0,0.2);
    width:360px;
    max-width:90%;
    text-align:center;
  }
  h2{color:var(--red); margin-bottom:25px; font-size:26px;}
  label{display:block; font-size:12px; text-align:left; margin-bottom:4px; font-weight:600;}
  input{
    width:100%; padding:12px; margin-bottom:12px; border-radius:10px; border:1px solid #ddd; font-size:16px;
  }
  input:focus{border-color:var(--red); outline:none; box-shadow:0 0 8px rgba(199,18,26,0.3);}
  button{
    width:100%; padding:12px; border:none; border-radius:10px; background:var(--red); color:white; font-weight:700; font-size:16px; cursor:pointer; margin-bottom:12px; transition:0.3s;
  }
  button:hover{background:#e32a3b;}
  .social-btns{display:flex; justify-content:space-between; margin-bottom:15px; gap: 10px;}
  .social-btns button{
    width:48%; background:#f0f0f0; color:#333; border:1px solid #ccc; font-weight:700;
  }
  .social-btns button:hover{background:#eee;}
  .message{height:20px; font-size:14px; margin-bottom:10px;}
  .switch-text{font-size:14px;}
  .switch-text a{color:var(--red); font-weight:700; cursor:pointer; text-decoration:none;}
  .social-btns img{
      width: 20px;
      height: 20px;
      margin-right: 8px;
  }
</style>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
    import { getDatabase, ref, get, set, child } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-database.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, FacebookAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";

    // Firebase config (replace with your real keys)
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY_HERE",
      authDomain: "the-vibenet.firebaseapp.com",
      databaseURL: "https://the-vibenet-default-rtdb.firebaseio.com",
      projectId: "the-vibenet",
      storageBucket: "the-vibenet.appspot.com",
      messagingSenderId: "750456552470",
      appId: "1:750456552470:web:87d410021cda7ef10a0937"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth(app);
    const googleProvider = new GoogleAuthProvider();
    const facebookProvider = new FacebookAuthProvider();

    get(child(ref(db), 'users/admin')).then((snapshot) => {
      if (!snapshot.exists()) {
        set(ref(db, 'users/admin'), { password: '1234' });
      }
    });

    onAuthStateChanged(auth, (user) => {
        if (user) {
            localStorage.setItem('currentUser', user.displayName || user.email);
            window.location.href = "vibenet.html"; // <-- Yahan par file ka naam update kar diya hai
        }
    });

    const formTitle = document.getElementById('formTitle');
    const usernameInput = document.getElementById('username');
    const passwordInput = document.getElementById('password');
    const mainBtn = document.getElementById('mainBtn');
    const switchLink = document.getElementById('switchLink');
    const usernameMsg = document.getElementById('usernameMsg');
    const socialMsg = document.getElementById('socialMsg');
    const usernameLabel = document.getElementById('usernameLabel');
    const googleBtn = document.getElementById('googleBtn');
    const facebookBtn = document.getElementById('facebookBtn');

    let mode='signup';

    usernameInput.addEventListener('input', ()=>{
      if(mode!=='signup'){ usernameMsg.textContent=''; return; } 
      let u = usernameInput.value.toLowerCase().replace(/\s+/g,'');
      usernameInput.value = u;
      if(!u){ usernameMsg.textContent=''; return; }
      get(child(ref(db), 'users/' + u)).then(snapshot=>{
        if(snapshot.exists()){ 
          usernameMsg.style.color='red'; 
          usernameMsg.textContent='Not Available'; 
        } else { 
          usernameMsg.style.color='green'; 
          usernameMsg.textContent='Available'; 
        }
      });
    });

    switchLink.addEventListener('click', ()=>{
      if(mode==='signup'){
        mode='login';
        formTitle.textContent='Login';
        mainBtn.textContent='Login';
        switchLink.textContent='Sign Up';
        usernameMsg.textContent='';
        socialMsg.textContent='';
        usernameLabel.textContent = "Username";
      } else {
        mode='signup';
        formTitle.textContent='Sign Up';
        mainBtn.textContent='Sign Up';
        switchLink.textContent='Login';
        usernameMsg.textContent='';
        socialMsg.textContent='';
        usernameLabel.textContent = "Create Username";
      }
    });

    mainBtn.addEventListener('click', ()=>{
      const u = usernameInput.value.trim().toLowerCase();
      const p = passwordInput.value;
      if(!u || !p){ socialMsg.style.color='red'; socialMsg.textContent='Enter both username and password'; return; }

      if(mode==='signup'){
        get(child(ref(db), 'users/' + u)).then(snapshot=>{
          if(snapshot.exists()){ socialMsg.style.color='red'; socialMsg.textContent='Username already exists'; return; }
          set(ref(db, 'users/' + u), {password:p});
          socialMsg.style.color='green'; socialMsg.textContent='Sign Up successful! Redirecting...';
          localStorage.setItem('currentUser', u);
          setTimeout(() => {
              window.location.href="vibenet.html"; // <-- Yahan par file ka naam update kar diya hai
          }, 1500);
        });
      } else {
        get(child(ref(db), 'users/' + u)).then(snapshot=>{
          if(!snapshot.exists()){ socialMsg.style.color='red'; socialMsg.textContent='Invalid username'; return; }
          if(snapshot.val().password!==p){ socialMsg.style.color='red'; socialMsg.textContent='Invalid password'; return; }
          socialMsg.style.color='green'; socialMsg.textContent='Login successful! Redirecting...';
          localStorage.setItem('currentUser', u);
          setTimeout(() => {
              window.location.href="vibenet.html"; // <-- Yahan par file ka naam update kar diya hai
          }, 1500);
        });
      }
    });

    async function handleSocialLogin(provider) {
        socialMsg.textContent = 'Logging in...';
        try {
            const result = await signInWithPopup(auth, provider);
            const user = result.user;
            let displayName = (user.displayName || user.email.split('@')[0]).toLowerCase().replace(/\s+/g, '');
            let username = displayName;
            let userRef = child(ref(db), 'users/' + username);
            let snapshot = await get(userRef);
            let i = 1;
            while(snapshot.exists()) {
                username = displayName + i;
                userRef = child(ref(db), 'users/' + username);
                snapshot = await get(userRef);
                i++;
            }
            await set(userRef, { password: 'social-login', email: user.email });
            socialMsg.style.color='green'; 
            socialMsg.textContent='Login successful! Redirecting...';
            localStorage.setItem('currentUser', username);
            setTimeout(() => {
                window.location.href="vibenet.html"; // <-- Yahan par file ka naam update kar diya hai
            }, 1500);
        } catch(error) {
            console.error(error);
            socialMsg.style.color='red'; socialMsg.textContent='Login failed. Please try again.';
        }
    }

    googleBtn.addEventListener('click', () => {
        handleSocialLogin(googleProvider);
    });

    facebookBtn.addEventListener('click', () => {
        handleSocialLogin(facebookProvider);
    });
</script>
</body>
</html>
